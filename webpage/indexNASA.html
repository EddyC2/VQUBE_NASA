<!DOCTYPE html>
<html>
  <head>
    <title>World Pollution Globe</title>
    <style>
      body { 
        margin: 0; 
        font-family: Arial, sans-serif;
        overflow: hidden;
        background: #000;
      }
      #globeViz {
        width: 100vw;
        height: 100vh;
      }
      #loading {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        background: rgba(0,0,0,0.8);
        padding: 20px 40px;
        border-radius: 10px;
        font-size: 16px;
        text-align: center;
        z-index: 1000;
      }
      #controls {
        position: absolute;
        top: 20px;
        right: 20px;
        color: white;
        background: rgba(0,0,0,0.8);
        padding: 15px;
        border-radius: 8px;
        font-size: 12px;
        z-index: 100;
        display: none;
      }
      #controls h3 {
        margin-top: 0;
        margin-bottom: 10px;
      }
      .legend-item {
        display: flex;
        align-items: center;
        margin: 5px 0;
      }
      .legend-color {
        width: 20px;
        height: 20px;
        margin-right: 8px;
        border-radius: 3px;
      }
      #yearSlider {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        width: 50%;
        z-index: 200;
      }
      #yearLabel {
        position: absolute;
        bottom: 60px;
        left: 50%;
        transform: translateX(-50%);
        color: white;
        font-size: 16px;
        z-index: 200;
        background: rgba(0,0,0,0.7);
        padding: 5px 12px;
        border-radius: 5px;
      }
    </style>
  </head>
  <body>
    <div id="loading">
      <div>üåç Loading World Globe...</div>
      <div style="margin-top: 10px; font-size: 12px;">Loading all countries...</div>
    </div>
    
    <div id="controls">
      <h3>üåç World Pollution</h3>
      <div class="legend-item">
        <div class="legend-color" style="background: #d73027;"></div>
        <span>High CO (>66)</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background: #fdae61;"></div>
        <span>Mid CO (33-66)</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background: #4daf4a;"></div>
        <span>Low CO (<33)</span>
      </div>
      <p style="font-size: 11px; margin-top: 15px; opacity: 0.8;">
        Hover over countries for details<br>
        Drag to rotate ‚Ä¢ Scroll to zoom
      </p>
    </div>

    <!-- Year label + slider -->
    <div id="yearLabel">Year: 2000</div>
    <input type="range" id="yearSlider" min="2000" max="2025" step="1" value="2000" />

    <div id="globeViz"></div>

    <script src="https://unpkg.com/globe.gl"></script>
    <script>
      let countriesData; // keep reference so we can update later

      // Initialize globe
      const world = Globe()
        (document.getElementById('globeViz'))
        .globeImageUrl('https://unpkg.com/three-globe/example/img/earth-day.jpg')
        .bumpImageUrl('https://unpkg.com/three-globe/example/img/earth-topology.png')
        .backgroundImageUrl('https://unpkg.com/three-globe/example/img/night-sky.png')
        .width(window.innerWidth)
        .height(window.innerHeight);

      // Fetch world countries GeoJSON
      fetch('https://raw.githubusercontent.com/nvkelso/natural-earth-vector/master/geojson/ne_110m_admin_0_countries.geojson')
        .then(res => res.json())
        .then(data => {
          countriesData = data;
          updateYear(2000); // initialize with year 2000

          world
            .polygonsData(countriesData.features)
            .polygonAltitude(0.01)
            .polygonCapColor(d => {
              const co = d.properties.co;
              if (co > 66) return '#d73027';
              if (co > 33) return '#fdae61';
              return '#4daf4a';
            })
            .polygonSideColor(() => 'rgba(0, 0, 0, 0.1)')
            .polygonStrokeColor(() => '#111')
            .polygonLabel(d => {
              const name = d.properties.ADMIN || d.properties.NAME || 'Unknown';
              return `
                <div style="background: rgba(0,0,0,0.9); color: white; padding: 12px; border-radius: 5px; max-width: 200px;">
                  <b style="font-size: 14px;">${name}</b><br/>
                  <hr style="border: none; border-top: 1px solid #555; margin: 8px 0;"/>
                  <div style="font-size: 12px;">
                    <b>CO Level:</b> ${d.properties.co.toFixed(1)}<br/>
                    <b>Status:</b> ${d.properties.pollution_level}<br/>
                    <b>NDVI:</b> ${d.properties.ndvi.toFixed(3)}<br/>
                    <b>Year:</b> ${d.properties.year}
                  </div>
                </div>
              `;
            });

          document.getElementById('loading').style.display = 'none';
          document.getElementById('controls').style.display = 'block';
        });

      // Function to update data by year
      function updateYear(year) {
        if (!countriesData) return;
        countriesData.features.forEach(feature => {
          // Replace this with your real year-based CO data later
          feature.properties.co = Math.random() * 100;
          feature.properties.ndvi = Math.random();
          feature.properties.pollution_level = feature.properties.co > 66 ? 'High' :
                                               feature.properties.co > 33 ? 'Medium' : 'Low';
          feature.properties.year = year;
        });
        world.polygonsData(countriesData.features); // re-bind updated data
        document.getElementById('yearLabel').textContent = "Year: " + year;
      }

      // Slider event
      document.getElementById('yearSlider').addEventListener('input', (e) => {
        updateYear(+e.target.value);
      });

      // Auto-rotate globe
      world.controls().autoRotate = true;
      world.controls().autoRotateSpeed = 0.3;
      world.controls().enableZoom = true;

      // Handle window resize
      window.addEventListener('resize', () => {
        world.width(window.innerWidth).height(window.innerHeight);
      });
    </script>
  </body>
</html>
