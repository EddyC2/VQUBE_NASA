<!DOCTYPE html>
<html>
  <head>
    <title>World Pollution Globe</title>
    <style>
      body { 
        margin: 0; 
        font-family: Arial, sans-serif;
        overflow: hidden;
        background: #000;
      }
      #globeViz {
        width: 100vw;
        height: 100vh;
      }
      #loading {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        background: rgba(0,0,0,0.8);
        padding: 20px 40px;
        border-radius: 10px;
        font-size: 16px;
        text-align: center;
        z-index: 1000;
      }
      #controls {
        position: absolute;
        top: 20px;
        right: 20px;
        color: white;
        background: rgba(0,0,0,0.8);
        padding: 15px;
        border-radius: 8px;
        font-size: 12px;
        z-index: 100;
        display: none;
      }
      #controls h3 {
        margin-top: 0;
        margin-bottom: 10px;
      }
      .legend-item {
        display: flex;
        align-items: center;
        margin: 5px 0;
      }
      .legend-color {
        width: 20px;
        height: 20px;
        margin-right: 8px;
        border-radius: 3px;
      }
    </style>
  </head>
  <body>
    <div id="loading">
      <div>üåç Loading World Globe...</div>
      <div style="margin-top: 10px; font-size: 12px;">Loading all countries...</div>
    </div>
    
    <div id="controls">
      <h3>üåç World Pollution</h3>
      <div class="legend-item">
        <div class="legend-color" style="background: #d73027;"></div>
        <span>High CO (>66)</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background: #fdae61;"></div>
        <span>Mid CO (33-66)</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background: #4daf4a;"></div>
        <span>Low CO (<33)</span>
      </div>
      <p style="font-size: 11px; margin-top: 15px; opacity: 0.8;">
        Hover over countries for details<br>
        Drag to rotate ‚Ä¢ Scroll to zoom
      </p>
    </div>
    
    <div id="globeViz"></div>

    <script src="https://unpkg.com/globe.gl"></script>
    <script>
      console.log('Starting world globe...');

      // Initialize globe
      const world = Globe()
        (document.getElementById('globeViz'))
        .globeImageUrl('https://unpkg.com/three-globe/example/img/earth-day.jpg')
        .bumpImageUrl('https://unpkg.com/three-globe/example/img/earth-topology.png')
        .backgroundImageUrl('https://unpkg.com/three-globe/example/img/night-sky.png')
        .width(window.innerWidth)
        .height(window.innerHeight);

      console.log('Globe initialized');

      // Fetch world countries GeoJSON
      fetch('https://raw.githubusercontent.com/nvkelso/natural-earth-vector/master/geojson/ne_110m_admin_0_countries.geojson')
        .then(res => res.json())
        .then(countriesData => {
          console.log('Countries loaded:', countriesData.features.length);

          // Add mock pollution data to each country
          countriesData.features.forEach(feature => {
            // Random CO value between 0-100
            feature.properties.co = Math.random() * 100;
            feature.properties.ndvi = Math.random();
            feature.properties.pollution_level = feature.properties.co > 66 ? 'High' : 
                                                  feature.properties.co > 33 ? 'Medium' : 'Low';
          });

          // Configure polygons (countries)
          world
            .polygonsData(countriesData.features)
            .polygonAltitude(0.01)
            .polygonCapColor(d => {
              const co = d.properties.co;
              if (co > 66) return '#d73027'; // Red
              if (co > 33) return '#fdae61'; // Orange
              return '#4daf4a'; // Green
            })
            .polygonSideColor(() => 'rgba(0, 0, 0, 0.1)')
            .polygonStrokeColor(() => '#111')
            .polygonLabel(d => {
              const name = d.properties.ADMIN || d.properties.NAME || d.properties.name || 'Unknown';
              return `
                <div style="background: rgba(0,0,0,0.9); color: white; padding: 12px; border-radius: 5px; font-family: Arial; max-width: 200px;">
                  <b style="font-size: 14px;">${name}</b><br/>
                  <hr style="border: none; border-top: 1px solid #555; margin: 8px 0;"/>
                  <div style="font-size: 12px;">
                    <b>CO Level:</b> ${d.properties.co.toFixed(1)}<br/>
                    <b>Status:</b> ${d.properties.pollution_level}<br/>
                    <b>NDVI:</b> ${d.properties.ndvi.toFixed(3)}
                  </div>
                </div>
              `;
            });

          console.log('World polygons configured');

          // Add major cities as points
          const cityData = [
            { lat: 40.71, lng: -74.00, size: 0.5, color: '#ff0000', name: 'New York' },
            { lat: 51.51, lng: -0.13, size: 0.5, color: '#ff8800', name: 'London' },
            { lat: 35.68, lng: 139.69, size: 0.5, color: '#ff0000', name: 'Tokyo' },
            { lat: 39.90, lng: 116.40, size: 0.5, color: '#ff0000', name: 'Beijing' },
            { lat: 28.61, lng: 77.21, size: 0.4, color: '#ff0000', name: 'New Delhi' },
            { lat: -23.55, lng: -46.63, size: 0.4, color: '#ff8800', name: 'S√£o Paulo' },
            { lat: 55.75, lng: 37.62, size: 0.4, color: '#ff8800', name: 'Moscow' },
            { lat: -33.87, lng: 151.21, size: 0.3, color: '#00ff00', name: 'Sydney' },
            { lat: 1.35, lng: 103.82, size: 0.3, color: '#ff8800', name: 'Singapore' },
            { lat: 19.43, lng: -99.13, size: 0.4, color: '#ff0000', name: 'Mexico City' }
          ];

          world
            .pointsData(cityData)
            .pointAltitude('size')
            .pointColor('color')
            .pointRadius(0.25)
            .pointLabel(d => `
              <div style="background: rgba(0,0,0,0.9); color: white; padding: 8px 12px; border-radius: 5px; font-family: Arial;">
                <b>${d.name}</b><br/>
                <span style="font-size: 11px;">Major City</span>
              </div>
            `);

          console.log('City points configured');

          // Start with a nice view
          world.pointOfView({
            lat: 30,
            lng: 0,
            altitude: 2.5
          }, 1000);

          // Hide loading, show controls
          setTimeout(() => {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('controls').style.display = 'block';
          }, 1500);

        })
        .catch(error => {
          console.error('Error loading countries:', error);
          document.getElementById('loading').innerHTML = 
            '<div style="color: #ff6666;">Error loading world data<br/><span style="font-size: 12px;">' + 
            error.message + '</span></div>';
        });

      // Auto-rotate globe
      world.controls().autoRotate = true;
      world.controls().autoRotateSpeed = 0.3;
      world.controls().enableZoom = true;

      // Handle window resize
      window.addEventListener('resize', () => {
        world.width(window.innerWidth).height(window.innerHeight);
      });

      console.log('World globe setup complete');
    </script>
  </body>
</html>